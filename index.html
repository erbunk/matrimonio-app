<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💒 Spese Matrimonio - Erasmo & Lexi</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const WeddingExpenseTracker = () => {
            const initialExpenses = [
                { id: 1, category: 'Venue', estimatedCost: 7845, actualCost: 0, paid: false, paymentDate: '', notes: '50% due at contract signing, remaining 50% due 90 days out' },
                { id: 2, category: 'Accommodations', estimatedCost: 2000, actualCost: 0, paid: false, paymentDate: '', notes: '40% due at booking, remaining 60% due 40 days before check-in' },
                { id: 3, category: 'Wedding Planner', estimatedCost: 3000, actualCost: 0, paid: false, paymentDate: '', notes: '' },
                { id: 4, category: 'Catering, Reception', estimatedCost: 20000, actualCost: 0, paid: false, paymentDate: '', notes: '' },
                { id: 5, category: 'Photography', estimatedCost: 6000, actualCost: 0, paid: false, paymentDate: '', notes: '' },
                { id: 6, category: 'Flowers', estimatedCost: 1500, actualCost: 0, paid: false, paymentDate: '', notes: '' },
                { id: 7, category: 'Bridal Outfit', estimatedCost: 3000, actualCost: 0, paid: false, paymentDate: '', notes: '' },
                { id: 8, category: 'Groom Outfit', estimatedCost: 900, actualCost: 0, paid: false, paymentDate: '', notes: '' },
                { id: 9, category: 'Music & DJ', estimatedCost: 3000, actualCost: 0, paid: false, paymentDate: '', notes: '' },
                { id: 10, category: 'Rings', estimatedCost: 3000, actualCost: 0, paid: false, paymentDate: '', notes: '' }
            ];

            const [expenses, setExpenses] = useState(() => {
                const saved = localStorage.getItem('weddingExpenses');
                return saved ? JSON.parse(saved) : initialExpenses;
            });

            const [editingId, setEditingId] = useState(null);
            const [editForm, setEditForm] = useState({});
            const [lastUpdate, setLastUpdate] = useState(localStorage.getItem('lastUpdate'));

            useEffect(() => {
                localStorage.setItem('weddingExpenses', JSON.stringify(expenses));
                const now = new Date().toISOString();
                localStorage.setItem('lastUpdate', now);
                setLastUpdate(now);
            }, [expenses]);

            const totalEstimated = expenses.reduce((sum, expense) => sum + expense.estimatedCost, 0);
            const totalActual = expenses.reduce((sum, expense) => sum + expense.actualCost, 0);
            const totalPaid = expenses.filter(expense => expense.paid).reduce((sum, expense) => sum + expense.actualCost, 0);

            const startEdit = (expense) => {
                setEditingId(expense.id);
                setEditForm({ ...expense });
            };

            const cancelEdit = () => {
                setEditingId(null);
                setEditForm({});
            };

            const saveEdit = () => {
                setExpenses(expenses.map(expense => 
                    expense.id === editingId ? { ...editForm } : expense
                ));
                setEditingId(null);
                setEditForm({});
            };

            const deleteExpense = (id) => {
                if (window.confirm('Sei sicuro di voler eliminare questa spesa?')) {
                    setExpenses(expenses.filter(expense => expense.id !== id));
                }
            };

            const togglePaid = (id) => {
                setExpenses(expenses.map(expense => 
                    expense.id === id ? { 
                        ...expense, 
                        paid: !expense.paid,
                        paymentDate: !expense.paid ? new Date().toISOString().split('T')[0] : ''
                    } : expense
                ));
            };

            const addNewExpense = () => {
                const newExpense = {
                    id: Date.now(),
                    category: 'Nuova Categoria',
                    estimatedCost: 0,
                    actualCost: 0,
                    paid: false,
                    paymentDate: '',
                    notes: ''
                };
                setExpenses([...expenses, newExpense]);
                startEdit(newExpense);
            };

            const exportData = () => {
                const dataToExport = {
                    expenses,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `matrimonio-spese-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (importedData.expenses && Array.isArray(importedData.expenses)) {
                            if (window.confirm('Questo sostituirà tutti i dati attuali. Continuare?')) {
                                setExpenses(importedData.expenses);
                                alert('Dati importati con successo! 🎉');
                            }
                        } else {
                            alert('File non valido!');
                        }
                    } catch (error) {
                        alert('Errore nel leggere il file!');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            return (
                <div style={{
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #fdf2f8 0%, #f3e8ff 50%, #e0e7ff 100%)',
                    padding: '16px'
                }}>
                    <div style={{ maxWidth: '1152px', margin: '0 auto' }}>
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <h1 className="text-5xl font-bold text-gray-800 mb-8 text-center">
                                💒 Spese Matrimonio Erasmo & Lexi
                            </h1>
                            
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div className="bg-blue-50 p-6 rounded-lg text-center border border-blue-200">
                                    <div className="text-lg text-blue-600 font-bold mb-2">Budget Stimato</div>
                                    <div className="text-4xl font-bold text-blue-800">${totalEstimated.toLocaleString()}</div>
                                </div>
                                <div className="bg-orange-50 p-6 rounded-lg text-center border border-orange-200">
                                    <div className="text-lg text-orange-600 font-bold mb-2">Speso Effettivo</div>
                                    <div className="text-4xl font-bold text-orange-800">${totalActual.toLocaleString()}</div>
                                </div>
                                <div className="bg-green-50 p-6 rounded-lg text-center border border-green-200">
                                    <div className="text-lg text-green-600 font-bold mb-2">Già Pagato</div>
                                    <div className="text-4xl font-bold text-green-800">${totalPaid.toLocaleString()}</div>
                                </div>
                                <div className="bg-purple-50 p-6 rounded-lg text-center border border-purple-200">
                                    <div className="text-lg text-purple-600 font-bold mb-2">Rimanente</div>
                                    <div className="text-4xl font-bold text-purple-800">${(totalEstimated - totalActual).toLocaleString()}</div>
                                </div>
                            </div>

                            <div className="flex flex-wrap gap-3 items-center justify-between mb-4">
                                <div className="flex flex-wrap gap-3">
                                    <button 
                                        onClick={addNewExpense}
                                        className="bg-pink-500 hover:bg-pink-600 text-white px-8 py-3 rounded-lg flex items-center gap-2 transition-colors font-bold text-lg"
                                    >
                                        ➕ Aggiungi Spesa
                                    </button>
                                    
                                    <button 
                                        onClick={exportData}
                                        className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors font-medium text-base"
                                    >
                                        📤 Esporta Dati
                                    </button>
                                    
                                    <label className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors cursor-pointer font-medium text-base">
                                        📥 Importa Dati
                                        <input
                                            type="file"
                                            accept=".json"
                                            onChange={importData}
                                            className="hidden"
                                        />
                                    </label>
                                </div>
                                
                                <div className="flex items-center gap-2 bg-green-100 text-green-800 px-4 py-2 rounded-lg text-base font-medium">
                                    ☁️ Online & Funzionante
                                </div>
                            </div>

                            {lastUpdate && (
                                <div className="text-center">
                                    <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full text-base font-medium bg-blue-100 text-blue-800">
                                        <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                                        Ultimo aggiornamento: {new Date(lastUpdate).toLocaleString('it-IT')}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="space-y-6">
                            {expenses.map((expense) => (
                                <div key={expense.id} className={`bg-white rounded-xl shadow-lg p-8 transition-all ${
                                    expense.paid ? 'bg-green-50 border-l-4 border-green-500' : 'border border-gray-200'
                                }`}>
                                    {editingId === expense.id ? (
                                        <div className="bg-yellow-50 p-6 rounded-lg border-2 border-yellow-300">
                                            <h3 className="text-2xl font-bold text-yellow-800 mb-6">✏️ Modifica Spesa</h3>
                                            <div className="space-y-6">
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                    <div>
                                                        <label className="block text-lg font-bold text-gray-700 mb-2">Categoria</label>
                                                        <input
                                                            type="text"
                                                            value={editForm.category || ''}
                                                            onChange={(e) => setEditForm({...editForm, category: e.target.value})}
                                                            className="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-lg font-bold text-gray-700 mb-2">Budget Stimato ($)</label>
                                                        <input
                                                            type="number"
                                                            value={editForm.estimatedCost || 0}
                                                            onChange={(e) => setEditForm({...editForm, estimatedCost: Number(e.target.value)})}
                                                            className="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-lg font-bold text-gray-700 mb-2">Costo Effettivo ($)</label>
                                                        <input
                                                            type="number"
                                                            value={editForm.actualCost || 0}
                                                            onChange={(e) => setEditForm({...editForm, actualCost: Number(e.target.value)})}
                                                            className="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-lg font-bold text-gray-700 mb-2">Data Pagamento</label>
                                                        <input
                                                            type="date"
                                                            value={editForm.paymentDate || ''}
                                                            onChange={(e) => setEditForm({...editForm, paymentDate: e.target.value})}
                                                            className="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                        />
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="block text-lg font-bold text-gray-700 mb-2">Note</label>
                                                    <textarea
                                                        value={editForm.notes || ''}
                                                        onChange={(e) => setEditForm({...editForm, notes: e.target.value})}
                                                        rows={3}
                                                        className="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                    />
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <input
                                                        type="checkbox"
                                                        checked={editForm.paid || false}
                                                        onChange={(e) => setEditForm({...editForm, paid: e.target.checked})}
                                                        className="w-5 h-5 text-pink-600 border-gray-300 rounded focus:ring-pink-500"
                                                    />
                                                    <label className="text-lg text-gray-700 font-bold">Spesa già pagata</label>
                                                </div>
                                                <div className="flex gap-4 pt-4">
                                                    <button 
                                                        onClick={saveEdit}
                                                        className="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg flex items-center gap-2 transition-colors font-bold text-lg"
                                                    >
                                                        💾 Salva
                                                    </button>
                                                    <button 
                                                        onClick={cancelEdit}
                                                        className="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg flex items-center gap-2 transition-colors font-bold text-lg"
                                                    >
                                                        ❌ Annulla
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="flex items-center justify-between">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-6 mb-4">
                                                    <h3 className="text-2xl font-bold text-gray-800">{expense.category}</h3>
                                                    <button
                                                        onClick={() => togglePaid(expense.id)}
                                                        className={`px-6 py-2 rounded-full text-lg font-bold transition-colors ${
                                                            expense.paid 
                                                                ? 'bg-green-100 text-green-800 hover:bg-green-200' 
                                                                : 'bg-red-100 text-red-800 hover:bg-red-200'
                                                        }`}
                                                    >
                                                        {expense.paid ? '✅ Pagato' : '❌ Non pagato'}
                                                    </button>
                                                </div>
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-6 text-base">
                                                    <div>
                                                        <span className="text-gray-500 block text-lg font-medium">Budget:</span>
                                                        <div className="font-bold text-2xl text-blue-700">${expense.estimatedCost.toLocaleString()}</div>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-500 block text-lg font-medium">Speso:</span>
                                                        <div className="font-bold text-2xl text-orange-700">
                                                            {expense.actualCost > 0 ? `$${expense.actualCost.toLocaleString()}` : '-'}
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-500 block text-lg font-medium">Data:</span>
                                                        <div className="font-bold text-base">{expense.paymentDate || '-'}</div>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-500 block text-lg font-medium">Note:</span>
                                                        <div className="font-medium text-sm leading-relaxed">
                                                            {expense.notes || 'Nessuna nota'}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="flex gap-4 ml-8">
                                                <button 
                                                    onClick={() => startEdit(expense)}
                                                    className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors font-bold text-lg"
                                                >
                                                    ✏️ Modifica
                                                </button>
                                                <button 
                                                    onClick={() => deleteExpense(expense.id)}
                                                    className="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors font-bold text-lg"
                                                >
                                                    🗑️ Elimina
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        <div className="mt-8 bg-white rounded-xl shadow p-8 text-center">
                            <p className="text-xl text-gray-700 font-bold">💒 App Spese Matrimonio</p>
                            <p className="text-base text-gray-500 mt-3">
                                📤📥 Export/Import per sincronizzazione Italia ↔ America
                            </p>
                            <div className="mt-4 text-sm text-gray-400">
                                Creata per Erasmo & Lexi ❤️
                            </div>
                            <div className="mt-4 p-4 bg-blue-50 rounded-lg">
                                <p className="text-sm text-blue-800 font-medium">
                                    📱 <strong>Come sincronizzare:</strong><br/>
                                    1. Modifica spese → Clicca "📤 Esporta Dati"<br/>
                                    2. Manda il file a Lexi via WhatsApp<br/>
                                    3. Lei clicca "📥 Importa Dati" → Carica il file<br/>
                                    4. Dati sincronizzati! 🎉
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<WeddingExpenseTracker />, document.getElementById('root'));
    </script>
</body>
</html>
